#pragma checksum "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\Pages\Registros\R_Ventas.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "a4cb9952899a70b691a0c2135d4bb0ae2ed8bc6b"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace FEG.Pages.Registros
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using FEG;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using FEG.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using Blazored.Toast;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\_Imports.razor"
using Blazored.Toast.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\Pages\Registros\R_Ventas.razor"
using Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\Pages\Registros\R_Ventas.razor"
using BLL;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/RVentas")]
    [Microsoft.AspNetCore.Components.RouteAttribute("/RVentas/{VentaId:int}")]
    public partial class R_Ventas : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 170 "C:\Users\14012\Desktop\ProyectoFinalPA2\StudioEF\Pages\Registros\R_Ventas.razor"
       

    Ventas Venta = new Ventas();
    VentasDetalle VentaD = new VentasDetalle();

    public int ClienteSeleccionado { get; set; }

    public int ArticuloSeleccionado { get; set; }

    [Parameter]
    public int VentaId { get; set; }

    public int cantidad { get; set; }
    public decimal monto { get; set; }
    public decimal precioArticulo { get; set; }
    public decimal precioEvento { get; set; }

    public int eventoId { get; set; }


    List<Clientes> ListaClientes = new List<Clientes>();
    List<Articulos> ListaArticulos = new List<Articulos>();
    List<Eventos> ListaEventos = new List<Eventos>();

    protected override void OnInitialized()
    {
        Nuevo();


    }



    private void Nuevo()
    {
        Venta = new Ventas();
        VentaD = new VentasDetalle();
        cantidad = 0;
        monto = 0;
        precioArticulo = 0;
        precioEvento = 0;
        ClienteSeleccionado = 0;
        ArticuloSeleccionado = 0;
        eventoId = 0;
        ListaArticulos = ArticulosBLL.GetList(a => true);
        ListaClientes = ClientesBLL.GetList(c => true);
        ListaEventos = EventosBLL.GetList(vd => true);
    }

    private string ObtenerDescripcion(int id)
    {
        string auxDescripcion = string.Empty;
        Articulos a = ArticulosBLL.Buscar(id);

        auxDescripcion = a.Descripcion;

        return auxDescripcion;
    }

    private void ObtenerNombresyApellidos()
    {
        string auxNombre = string.Empty;
        string auxApellidos = string.Empty;
        Clientes c = ClientesBLL.Buscar(ClienteSeleccionado);

        if(c != null){
            Venta.ClienteId = c.ClienteId;
            Venta.Nombres = c.Nombres;
            Venta.Apellidos = c.Apellidos;
        }
        else
        {
            toast.ShowError("No Existe en la base de datos");
        }


    }

    private void ObtenerPrecioArticulo()
    {
        Articulos auxArticulo = ArticulosBLL.Buscar(ArticuloSeleccionado);

        if (auxArticulo != null)
        {
            precioArticulo = auxArticulo.Precio;
        }
    }

    private void ObtenerPrecioEvento()
    {

        Eventos auxEvento = EventosBLL.Buscar(eventoId);

        if (auxEvento != null)
        {
            precioEvento = auxEvento.Precio;
        }

        CalcularMonto();

    }

    private void Guardar()
    {
        bool paso;
        paso = VentasBLL.Guardar(Venta);

        if (paso)
        {
            Nuevo();
            toast.ShowSuccess("Guardado correctamente");
        }
        else
        {
            toast.ShowError("No fue posible guardar");
        }
    }

    private void Agregar()
    {
        if (ClienteSeleccionado == 0)
        {
            toast.ShowWarning("Tiene que seleccionar un producto.");
            return;
        }

        if (cantidad <= 0)
        {
            toast.ShowWarning("La cantidad debe ser mayor a 0.");
            return;
        }
        else
        {
            this.Venta.VentasDetalle.Add(new VentasDetalle
            {

                ArticuloId = ArticuloSeleccionado,
                Descripcion = ObtenerDescripcion(ArticuloSeleccionado),
                Cantidad = cantidad,
                PrecioArticulo = precioArticulo,
                EventoId = eventoId,
                PrecioEvento = precioEvento,
                Monto = monto

            });

            VentasBLL.RestarCantidad(Venta);
            CalcularTotal();

            ClienteSeleccionado = 0;



        }

    }

    private void Eliminar()
    {
        bool elimino;

        elimino = VentasBLL.Eliminar(Venta.VentaId);

        if (elimino)
        {
            Nuevo();
            toast.ShowSuccess("Eliminado correctamente");
        }
        else
            toast.ShowError("No fue posible eliminar");
    }


    private void CalcularTotal()
    {
        decimal total = 0;

        foreach (var item in Venta.VentasDetalle)
        {
            total += (item.PrecioArticulo * item.Cantidad) + item.PrecioEvento;
        }

        Venta.Total = total;
    }


    private void CalcularMonto()
    {
        decimal Monto = 0;

        Monto = (precioArticulo * cantidad) + precioEvento;

        monto = Monto;
    }

    private void EliminarDetalle(VentasDetalle detalle)
    {
        try
        {
            VentasBLL.SumarCantidad(Venta);
            Venta.VentasDetalle.Remove(detalle);

        }
        catch (Exception)
        {
            throw;
        }
    }


    private void Buscar()
    {
        if (Venta.VentaId > 0)
        {
            var encontrado = VentasBLL.Buscar(Venta.VentaId);

            if (encontrado != null)
                this.Venta = encontrado;
            else
                toast.ShowWarning("No encontrado");
        }
    }


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AuthenticationStateProvider AuthenticationStateProvider { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IToastService toast { get; set; }
    }
}
#pragma warning restore 1591
